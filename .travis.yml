language: node_js
node_js:
  - "10"

# make use of vm's 
sudo: 'required'

# have the docker service set up (we'll
# update it later)
services:
  - 'docker'

before_install:
  - curl -sSL https://cli.openfaas.com | sudo sh
  - cd base64 && npm install && cd ..

script:
  - cd base64 && npm run test && cd ..
  - faas-cli build -f base64.yml

notifications:
  email:
    recipients:
      - templum.dev@gmail.com
    on_success: change
    on_failure: always

after_success:
  - if [[ "$TRAVIS_BRANCH" == "master" ]]; then docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD; fi
  - docker tag templum/functions-base64:latest "templum/functions-base64:${TRAVIS_COMMIT}"
  - if [[ "$TRAVIS_BRANCH" == "master" ]]; then docker push "templum/functions-base64:${TRAVIS_COMMIT}"; fi
